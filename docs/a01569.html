<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EPC9143 300 W 16th Brick DC/DC Module Reference Design: Power Supply Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mchp.css" rel="stylesheet" type="text/css"/>
<link href="mchp_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color: #000000;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 36px;">
  <td id="projectlogo" style="padding-left: 0.2em; vertical-align: middle;"><img alt="Logo" src="microchip-docs.png"/></td>
  <td id="projectalign" style="padding-left: 0.0em;">
   <div id="projectname" style="color: white; font-size:16px;">EPC9143 300 W 16th Brick DC/DC Module Reference Design
   </div>
  </td>
   <td style="padding-top: 10px; height: 20px; vertical-align: top;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a01569.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Power Supply Control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span id="startDoc"> </span> </p><div style="text-align:left"> <img src="images/startbanner.png" alt="Firmware Quick-Start Guide" height="70" width="880" class="inline"/> </div><h1><a class="anchor" id="autotoc_md17"></a>
Table of Contents</h1>
<ul>
<li><a href="#vmc_1">Advanced Type IV Voltage Mode Control Loop Implementation</a></li>
<li><a href="#vmc_2">Control Loop Block Diagram</a></li>
<li><a href="#vmc_3">Control Loop Timing</a></li>
<li><a href="#vmc_4">Control Loop Flow Chart</a></li>
<li><a href="#vmc_5">Control Loop Firmware Implementation</a></li>
</ul>
<p><span id="vmc_1"> </span></p>
<h1><a class="anchor" id="autotoc_md18"></a>
1) Advanced Type IV Voltage Mode Control Loop Implementation</h1>
<p>This firmware demonstrates the implementation of an advanced, single loop voltage mode controller used to regulate the constant output voltage of the 300W 16th brick DC/DC converter power module reference design. The implementation of the Advanced Voltage Feedback Loop requires four Analog-to-Digital Converter (ADC) inputs oversampling the input and output voltage as well as one inductor current per phase of the converter and four PWM outputs (PWM high and PWM low of phases #1 and #2) to drive the power converter half-bridge switch nodes in synchronous mode.</p>
<p>[<a href="#startDoc">back</a>] <span id="vmc_2"> </span></p>
<h1><a class="anchor" id="autotoc_md19"></a>
2) Control Loop Block Diagram</h1>
<p><em>Figure 1</em> shows the block diagram of the buck converter voltage mode controller, where one ADC input is used to sample the most recent level of the output voltage feedback signal, the second ADC input is used to sample the most recent level of the input voltage feedback signal and two additional ADC inputs are used to sample the most recent level of the phase current feedback signals. Once the most recent output voltage sample has been converted, the value is then compared against the internal reference value and the inverse of the deviation between reference and feedback (= <em>error</em>) is pushed through the discrete compensation filter.</p>
<p>During execution, the control loop incorporates the most recent input voltage value calculating the input/output voltage related gain deviation from pre-defined nominal operating conditions. The detected gain deviation is then compensated by tuning the loop gain in real-time.</p>
<p>In the Anti-Windup block, the output of the compensation filter is checked against user-specified minimum and maximum thresholds. Should any of these thresholds be exceeded, the controller output will be overwritten with the respective threshold value before being forwarded into the PWM distribution block.</p>
<p>The PWM distribution block serves two purposes:</p>
<ul>
<li>Incorporating current balancing deviation into control output</li>
<li>Distributing the most recent controller output onto both phases, shifted in phase by 180° with respect to each other</li>
</ul>
<p>High-speed balancing of phase currents is achieved by sampling each phase current at the mid-point of the respective current ripple feedback waveform, effectively tracking the average current in each phase. The two samples taken are compared and their difference is processed in a majority filter approach, resulting in an increment or decrement of the duty cycle of phase B by one PWM tick off the most recent control output per step. Thus, current feedback mismatches are balanced in less than one millisecond without risk of oscillations. During continuous operation phase currents are balanced in 100 usec steps.</p>
<div style="text-align:center"> <img src="images/type4-avmc.png" alt="Firmware Quick-Start Guide" width="800" class="inline"/> <br  />
<em>Figure 1: Control Loop Block Diagram</em><br  />
 </div><p> <br  />
</p>
<p>[<a href="#startDoc">back</a>] <span id="vmc_3"> </span></p>
<h1><a class="anchor" id="autotoc_md20"></a>
3) Control Loop Timing</h1>
<p>The single voltage loop controller is triggered by the PWM counter at the same time as the ADC is triggered. The control loop is executing the overhead code of calculating the first part of the compensation filter term (= <em>A-Term</em>) until the most recent ADC sample is available to be processed in the later part of the compensation filter term computation (= <em>B-Term</em>). This approach helps to shorten the overall response time of the controller measured between ADC trigger and write back event of the most recent controller result to the duty cycle register of the PWM generator. The new controller output value will then be divided by two and added to half of the period value to place the new ADC trigger point at 50% of the off-time. If the user has specified an additional offset to compensate FET driver propagation delays, this constant time-offset is also added before the ADC trigger location is updated. The the new duty cycle value will be updated immediately when the new value of the ADC trigger location is written to the PWM generator logic. By placing the ADC trigger point at 50% of the off time, the total control loop response is less than half a switching period, resulting in minimized phase erosion.</p>
<div style="text-align:center"> <img src="images/control_timing.png" alt="Firmware Quick-Start Guide" width="800" class="inline"/> <br  />
<em>Figure 2: Control Loop Timing</em><br  />
 </div><p> <br  />
</p>
<p>[<a href="#startDoc">back</a>] <span id="vmc_4"> </span></p>
<h1><a class="anchor" id="autotoc_md21"></a>
4) Control Loop Flow Chart</h1>
<p><em>Figure 3</em> shows a typical flow chart of a discrete software feedback loop called at the desired control frequency. It covers the loop path from ADC trigger to PWM output shown in the block diagram above (see <em>Figure 2</em>) while supporting additional features like an <em>Enable/Disable Bypass Switch</em> or advanced features like <em>Adaptive Gain Control (AGC)</em>.</p>
<ul>
<li><span style="color:green"> <b>[green]</b></span> boxes represent default building blocks</li>
<li><span style="color:grey"> <b>[grey]</b> </span> boxes represent unused optional features</li>
<li><span style="color:blue"> <b>[blue]</b> </span> boxes represent active optional features</li>
</ul>
<div style="text-align:center"> <img src="images/npnz16b-flowchart.png" alt="Firmware Quick-Start Guide" width="460" class="inline"/> <br  />
<em>Figure 3: Control Loop Flow Chart</em><br  />
 </div><p> <br  />
</p>
<p>[<a href="#startDoc">back</a>] <span id="vmc_5"> </span></p>
<h1><a class="anchor" id="autotoc_md22"></a>
5) Control Loop Firmware Implementation</h1>
<p><em>Figure 4</em> shows a typical implementation of the power converter state machine and the high-speed control loop in a task scheduler based firmware environment.</p>
<ul>
<li><span style="color:darkorange"> <b>Real Time Control Loop and Low Level Drivers</b> </span> The control loop is called in an independent high priority Interrupt Service Routine (ISR) by the PWM module simultaneously with triggering the ADC input. Thus, the control loop is tightly coupled to the PWM switching signal and synchronized to the most recent ADC conversion process, allowing a highly deterministic arrangement of code execution, peripheral module activity and external analog circuit operation. The interrupt priority needs to be high enough to override all other software tasks of the firmware to ensure jitter-free execution of the control loop. <br  />
<br  />
</li>
<li><span style="color:green"> <b>Topology-Specific State Machine Library</b></span> Each converter topology requires a specifically tailored configuration of related chip resources as well as start-up, control and monitoring procedures. <em>Topology State Machine Libraries</em> support a wide range of circuit configurations, control modes and functional features. Build-in peripheral configuration drivers are used to ease the configuration of required chip resources, such as number of PWM channels and their signal configuration, number of Analog-to-Digital (ADC) inputs, analog comparators, Digital-to-Analog Converter (DAC) channels, etc. All user configurations of a topology specific power converter are encapsulated in a comprehensive data object. This approach allows the definition of multiple power supplies of the same type being included, monitored and run independently from each other. Each of these power converter objects also include the declaration of the high-speed control loop object described above, enabling it to control peripherals and control loop code to be synchronized to time-critical states. <br  />
<br  />
</li>
<li><span style="color:darkblue"> <b>Application Layer of the Power Supply Control Task</b> </span> The application layer of this task is the proprietary firmware component covering the application-specific configuration of library data objects and high-speed control loops. It also allows to add and tailor functions, which are not covered by the default features of library modules. <br  />
<br  />
</li>
<li><span style="color:grey"> <b>Scheduler Level</b> </span> The scheduler level organizes all tasks of the firmware. Besides the power control and related fault handler task, this DPSK3 code example includes the on-board LC display data output, the on-board push-button control of the LC display screens and the on-board debugging LED, which are considered less time critical, low-priority tasks. The main task scheduler in this firmware example therefore supports two priority levels, one for power control and fault handling, executed at a rate of 10 kHz (= 100 us interval) and the low priority tasks, executed at rates between 0.5 ms and 250 ms. <br  />
<br  />
</li>
</ul>
<div style="text-align:center"> <img src="images/control-flow-chart.png" alt="Firmware Quick-Start Guide" width="960" class="inline"/> <br  />
<em>Figure 4: Control Loop Firmware Implementation</em><br  />
 </div><p><br  />
 <br  />
 More detailed information on the library implementation, such as task and library APIs, can be found in the chapter <em>Software Overview</em> on the left side of this window.</p>
<p>[<a href="#startDoc">back</a>]</p>
<hr  />
<p> (c) 2021, Microchip Technology Inc. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <p style="height: 12px; padding-bottom: 8px; padding-right: 12px; vertical-align: bottom; text-align: right; font-size: 90%;">© 2021, Microchip Technology Inc.</p>
  </ul>
</div>
</body>
</html>
