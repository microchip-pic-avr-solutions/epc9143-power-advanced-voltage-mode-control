<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EPC9143 300 W 16th Brick DC/DC Module Reference Design: epc9143-avmc.X/sources/power_control/drivers/v_loop_asm.s Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="mchp.css" rel="stylesheet" type="text/css"/>
<link href="mchp_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color: #000000;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 36px;">
  <td id="projectlogo" style="padding-left: 0.2em; vertical-align: middle;"><img alt="Logo" src="microchip-docs.png"/></td>
  <td id="projectalign" style="padding-left: 0.0em;">
   <div id="projectname" style="color: white; font-size:16px;">EPC9143 300 W 16th Brick DC/DC Module Reference Design
   </div>
  </td>
   <td style="padding-top: 10px; height: 20px; vertical-align: top;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00323_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">v_loop_asm.s</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;; **********************************************************************************</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;;  SDK Version: PowerSmartâ„¢ Digital Control Library Designer v0.9.12.672</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;;  CGS Version: Code Generator Script v3.0.6 (02/03/2021)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;;  Author:      M91406</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;;  Date/Time:   02/17/2021 10:08:26</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;; **********************************************************************************</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;;  4P4Z Control Library File (Dual Bitshift-Scaling Mode)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;; **********************************************************************************</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;;file start</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    .nolist                                 ; (no external dependencies)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    .list                                   ; list of all external dependencies</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;;local inclusions.</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    .section .data                          ; place constant data in the data section</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;; Define status flags bit positions</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    .equ NPNZ16_STATUS_ENABLED,      15     ; bit position of the ENABLE control bit</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    .equ NPNZ16_STATUS_INVERT_INPUT, 14     ; bit position of the INVERT_INPUT control bit</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    .equ NPNZ16_STATUS_SWAP_SOURCE,  13     ; bit position of the SWAP_SOURCE control bit</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    .equ NPNZ16_STATUS_SWAP_TARGET,  12     ; bit position of the SWAP_TARGET control bit</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    .equ NPNZ16_STATUS_AGC_ENABLED,  11     ; bit position of the AGC_ENABLED control bit</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    .equ NPNZ16_STATUS_USAT,         1      ; bit position of the UPPER_SATURATION_FLAG status bit</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    .equ NPNZ16_STATUS_LSAT,         0      ; bit position of the LOWER_SATURATION_FLAG status bit</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;; NPNZ16b_s data structure address offset declarations for data structure addressing</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    .equ Status,                        0   ; controller object status word at address-offset = 0</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    .equ ptrSourceRegister,             2   ; parameter group Ports.Source: pointer to source memory address</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    .equ SourceNormShift,               4   ; parameter group Ports.Source: bit-shift scaler of normalization factor</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    .equ SourceNormFactor,              6   ; parameter group Ports.Source: Q15 normalization factor</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    .equ SourceOffset,                  8   ; parameter group Ports.Source: value of source input signal/value offset</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    .equ ptrAltSourceRegister,          10  ; parameter group Ports.AltSource: pointer to alternate source memory address</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    .equ AltSourceNormShift,            12  ; parameter group Ports.AltSource: bit-shift scaler of normalization factor</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    .equ AltSourceNormFactor,           14  ; parameter group Ports.AltSource: Q15 normalization factor</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    .equ AltSourceOffset,               16  ; parameter group Ports.AltSource: value of alternate source input signal/value offset</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    .equ ptrTargetRegister,             18  ; parameter group Ports.Target: pointer to target memory address</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    .equ TargetNormShift,               20  ; parameter group Ports.Target: bit-shift scaler of normalization factor</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    .equ TargetNormFactor,              22  ; parameter group Ports.Target: Q15 normalization factor</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    .equ TargetOffset,                  24  ; parameter group Ports.Target: value of target output signal/value offset</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    .equ ptrAltTargetRegister,          26  ; parameter group Ports.AltTarget: pointer to alternate target memory address</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    .equ AltTargetNormShift,            28  ; parameter group Ports.AltTarget: bit-shift scaler of normalization factor</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    .equ AltTargetNormFactor,           30  ; parameter group Ports.AltTarget: Q15 normalization factor</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    .equ AltTargetOffset,               32  ; parameter group Ports.AltTarget: value of alternate target output signal/value offset</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    .equ ptrControlReference,           34  ; parameter group Ports.ConrolReference: pointer to control reference variable/register memory address</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    .equ ptrACoefficients,              36  ; parameter group Filter: pointer to A-coefficients array start address</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    .equ ptrBCoefficients,              38  ; parameter group Filter: pointer to B-coefficients array start address</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    .equ ptrControlHistory,             40  ; parameter group Filter: pointer to control history array start address</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    .equ ptrErrorHistory,               42  ; parameter group Filter: pointer to error history array start address</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    .equ ACoefficientsArraySize,        44  ; parameter group Filter: size of the A-coefficients array</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    .equ BCoefficientsArraySize,        46  ; parameter group Filter: size of the B-coefficients array</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    .equ ControlHistoryArraySize,       48  ; parameter group Filter: size of the control history array</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    .equ ErrorHistoryArraySize,         50  ; parameter group Filter: size of the error history array</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    .equ normPreShift,                  52  ; parameter group Filter: value of input value normalization bit-shift scaler</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    .equ normPostShiftA,                54  ; parameter group Filter: value of A-term normalization bit-shift scaler</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    .equ normPostShiftB,                56  ; parameter group Filter: value of B-term normalization bit-shift scaler</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    .equ normPostScaler,                58  ; parameter group Filter: control loop output normalization factor</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    .equ PTermScaler,                   60  ; parameter group Filter: P-Term coefficient scaler</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    .equ PTermFactor,                   62  ; parameter group Filter: P-Term coefficient fractional factor</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    .equ AgcScaler,                     64  ; parameter group GainControl: bit-shift scaler of Adaptive Gain Control Modulation factor</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    .equ AgcFactor,                     66  ; parameter group GainControl: Q15 value of Adaptive Gain Control Modulation factor</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    .equ AgcMedian,                     68  ; parameter group GainControl: Q15 value of Adaptive Gain Control Modulation nominal operating point</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    .equ ptrAgcObserverFunction,        70  ; parameter group GainControl: function pointer to observer function updating the AGC modulation factor</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    .equ MinOutput,                     72  ; parameter group Limits: minimum clamping value of primary control output</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    .equ MaxOutput,                     74  ; parameter group Limits: maximum clamping value of primary control output</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    .equ AltMinOutput,                  76  ; parameter group Limits: minimum clamping value of alternate control output</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    .equ AltMaxOutput,                  78  ; parameter group Limits: maximum clamping value of alternate control output</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    .equ ptrADCTriggerARegister,        80  ; parameter group ADCTriggerControl: pointer to ADC trigger A register memory address</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    .equ ADCTriggerAOffset,             82  ; parameter group ADCTriggerControl: value of ADC trigger A offset</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    .equ ptrADCTriggerBRegister,        84  ; parameter group ADCTriggerControl: pointer to ADC trigger B register memory address</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    .equ ADCTriggerBOffset,             86  ; parameter group ADCTriggerControl: value of ADC trigger B offset</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    .equ ptrDProvControlInput,          88  ; parameter group DataProviders: pointer to external variable/register the most recent, raw control input will be pushed to</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    .equ ptrDProvControlInputComp,      90  ; parameter group DataProviders: pointer to external variable/register the most recent, compensated control input will be pushed to</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    .equ ptrDProvControlError,          92  ; parameter group DataProviders: pointer to external variable/register the most recent control error will be pushed to</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    .equ ptrDProvControlOutput,         94  ; parameter group DataProviders: pointer to external variable/register the most recent control output will be pushed to</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    .equ ptrExtHookStartFunction,       96  ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller at the beginning after evaluating the enable flag. This function call will be bypassed when the controller is disabled.</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    .equ ExtHookStartFunctionParam,     98  ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    .equ ptrExtHookSourceFunction,      100 ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller after the most recent controller input has been read and compensated but before the most recent error is calculated.</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    .equ ExtHookSourceFunctionParam,    102 ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    .equ ptrExtHookPreAntiWindupFunction, 104 ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller after the most recent compensation filter result has been computed and before  anti-windup clamping is applied</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    .equ ExtHookPreAntiWindupFunctionParam, 106 ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    .equ ptrExtHookTargetFunction,      108 ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller before the most recent controller output is written to target, after the value has passed through anti-windup clamping.</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    .equ ExtHookTargetFunctionParam,    110 ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    .equ ptrExtHookStopFunction,        112 ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller after the compensation loop computation has been completed. This function call will be bypassed when the controller is disabled.</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    .equ ExtHookStopFunctionParam,      114 ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    .equ ptrExtHookEndFunction,         116 ; parameter group ExtensionHooks: pointer to external extension function which will be called by this controller after the compensation loop computation has been completed, regardless of the loop execution being bypassed or not</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    .equ ExtHookEndFunctionParam,       118 ; parameter group ExtensionHooks: 16-bit wide function parameter variable or pointer to a parameter variable or data structure of extension function</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    .equ usrParam0,                     120 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #1 for user-defined, advanced control options</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    .equ usrParam1,                     122 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #2 for user-defined, advanced control options</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    .equ usrParam2,                     124 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #3 for user-defined, advanced control options</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    .equ usrParam3,                     126 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #4 for user-defined, advanced control options</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    .equ usrParam4,                     128 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #5 for user-defined, advanced control options</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    .equ usrParam5,                     130 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #6 for user-defined, advanced control options</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    .equ usrParam6,                     132 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #7 for user-defined, advanced control options</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    .equ usrParam7,                     134 ; parameter group Advanced: generic 16-bit wide, user-defined parameter #8 for user-defined, advanced control options</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;;source code section.</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    .section .text                          ; place code in the text section</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;; Global function declaration</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;; This function calls the z-domain controller processing the latest data point input</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    .global _v_loop_Update                  ; provide global scope to routine</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    _v_loop_Update:                         ; local function label</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;; Check status word for Enable/Disable flag and bypass computation, if disabled</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    btss [w0], #NPNZ16_STATUS_ENABLED       ; check ENABLED bit state, skip (do not execute) next instruction if set</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    bra V_LOOP_LOOP_BYPASS                  ; if ENABLED bit is cleared, jump to end of control code</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;; Setup pointers to A-Term data arrays</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    mov [w0 + #ptrACoefficients], w8        ; load pointer to first index of A coefficients array</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;; Load pointer to first element of control history array</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    mov [w0 + #ptrControlHistory], w10      ; load pointer address into working register</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;; Compute compensation filter term</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    clr a, [w8]+=4, w4, [w10]+=2, w6        ; clear accumulator A and prefetch first operands</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    mac w4*w6, a, [w8]+=4, w4, [w10]+=2, w6 ; multiply control output (n-1) from the delay line with coefficient A1</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    mac w4*w6, a, [w8]+=4, w4, [w10]+=2, w6 ; multiply control output (n-2) from the delay line with coefficient A2</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    mac w4*w6, a, [w8]+=4, w4, [w10]+=2, w6 ; multiply control output (n-3) from the delay line with coefficient A3</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    mac w4*w6, a                            ; multiply &amp; accumulate last control output with coefficient of the delay line (no more prefetch)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;; Backward normalization of recent result</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    mov [w0 + #normPostShiftA], w6          ; load A-coefficients post bit-shift scaler value into working register</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    sftac a, w6                             ; shift accumulator A by number of bits loaded in working register</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;; Update error history (move error one tick down the delay line)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    mov [w10 + #6], w6                      ; move entry (n-4) into buffer</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    mov w6, [w10 + #8]                      ; move buffered value one tick down the delay line</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    mov [w10 + #4], w6                      ; move entry (n-3) into buffer</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    mov w6, [w10 + #6]                      ; move buffered value one tick down the delay line</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    mov [w10 + #2], w6                      ; move entry (n-2) into buffer</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    mov w6, [w10 + #4]                      ; move buffered value one tick down the delay line</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    mov [w10 + #0], w6                      ; move entry (n-1) into buffer</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    mov w6, [w10 + #2]                      ; move buffered value one tick down the delay line</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;; Read data from input source</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    mov [w0 + #ptrSourceRegister], w2       ; load pointer to input source register</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    mov [w2], w1                            ; move value from input source into working register</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    mov [w0 + #ptrDProvControlInputComp], w2 ; load pointer address of target buffer of most recent, compensated controller input from data structure</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    mov w1, [w2]                            ; copy most recent controller input value to given data buffer target</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;; Load reference and calculate error input to transfer function</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    mov [w0 + #ptrControlReference], w2     ; move pointer to control reference into working register</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    subr w1, [w2], w1                       ; calculate error (=reference - input)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    mov [w0 + #normPreShift], w2            ; move error input scaler into working register</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    sl w1, w2, w1                           ; normalize error result to fractional number format</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;; Setup pointers to B-Term data arrays</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    mov [w0 + #ptrBCoefficients], w8        ; load pointer to first index of B coefficients array</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    mov w1, [w10]                           ; add most recent error input to history array</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;; Compute B-Term of the compensation filter</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    clr b, [w8]+=4, w4, [w10]+=2, w6        ; clear accumulator B and prefetch first operands</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    mac w4*w6, b, [w8]+=4, w4, [w10]+=2, w6 ; multiply &amp; accumulate error input (n-0) from the delay line with coefficient B0 and prefetch next operands</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    mac w4*w6, b, [w8]+=4, w4, [w10]+=2, w6 ; multiply &amp; accumulate error input (n-1) from the delay line with coefficient B1 and prefetch next operands</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    mac w4*w6, b, [w8]+=4, w4, [w10]+=2, w6 ; multiply &amp; accumulate error input (n-2) from the delay line with coefficient B2 and prefetch next operands</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    mac w4*w6, b, [w8]+=4, w4, [w10]+=2, w6 ; multiply &amp; accumulate error input (n-3) from the delay line with coefficient B3 and prefetch next operands</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    mac w4*w6, b                            ; multiply &amp; accumulate last error input with coefficient of the delay line (no more prefetch)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;; Backward normalization of recent result</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    mov [w0 + #normPostShiftB], w6          ; load B-coefficients post bit-shift scaler value into working register</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    sftac b, w6                             ; shift accumulator B by number of bits loaded in working register</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;; Adaptive Loop Gain Modulation</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    mov  #ACCBH, w2                         ; capture address of accumulator B high word and store it in working register</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    fbcl [w2], w3                           ; find first bit change from left in accumulator B and store position in working register</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    sftac b, w3                             ; shift accumulator by &#39;n&#39; bits to scale contents into ACCH window</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    sac.r b, w6                             ; store result of accumulator B in working register</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    mov [w0 + ptrAgcObserverFunction], w1   ; load function pointer to observer function</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    call w1                                 ; call extern observer function to update gain modulation factor</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    mov [w0 + #AgcFactor], w4               ; load AGC modulation factor into working register</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    mov [w0 + #AgcScaler], w2               ; load AGC modulation factor scaler into working register</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    mpy w4*w6, b                            ; multiply accumulator B result with AGC modulation factor</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    neg w3, w3                              ; negate previously stored accumulator shift value</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    add w3, w2, w2                          ; add post scaler bit-shift scaler and accumulator scaler</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    sftac b, w2                             ; shift result by AGC scaler with accumulator scaling</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;; Add accumulators finalizing LDE computation</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    add a                                   ; add accumulator b to accumulator a</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    sac.r a, w4                             ; store most recent accumulator result in working register</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;; Controller Anti-Windup (control output value clamping)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;     </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;; Check for lower limit violation</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    mov [w0 + #MinOutput], w6               ; load lower limit value</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    cpsgt w4, w6                            ; compare values and skip next instruction if control output is within operating range (control output &gt; lower limit)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    mov w6, w4                              ; override controller output</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    V_LOOP_CLAMP_MIN_EXIT:</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;     </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;; Check for upper limit violation</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    mov [w0 + #MaxOutput], w6               ; load upper limit value</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    cpslt w4, w6                            ; compare values and skip next instruction if control output is within operating range (control output &lt; upper limit)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    mov w6, w4                              ; override controller output</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    V_LOOP_CLAMP_MAX_EXIT:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;; Write control output value to target</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    mov [w0 + #ptrTargetRegister], w8       ; capture pointer to target in working register</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    mov w4, [w8]                            ; move control output to target address</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    mov [w0 + #ptrAltTargetRegister], w8    ; capture pointer to alternate target in working register</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    mov w4, [w8]                            ; move control output to alternate target address</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;; Update ADC trigger locations</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    asr w4, #1, w6                          ; half control output by shifting value one bit to the right</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    ; Update ADC trigger A position</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    mov [w0 + #ADCTriggerAOffset], w8       ; load user-defined ADC trigger A offset value into working register</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    add w6, w8, w10                         ; add user-defined ADC trigger A offset to half of control output</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    mov [w0 + #ptrADCTriggerARegister], w8  ; load pointer to ADC trigger A register into working register</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    mov w10, [w8]                           ; push new ADC trigger value to ADC trigger A register</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;; Load pointer to first element of control history array</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    mov [w0 + #ptrControlHistory], w10      ; load pointer address into working register</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;; Update control output history (move entries one tick down the delay line)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    mov [w10 + #4], w6                      ; move entry (n-3) one tick down the delay line</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    mov w6, [w10 + #6]</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    mov [w10 + #2], w6                      ; move entry (n-2) one tick down the delay line</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    mov w6, [w10 + #4]</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    mov [w10 + #0], w6                      ; move entry (n-1) one tick down the delay line</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    mov w6, [w10 + #2]</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    mov w4, [w10]                           ; add most recent control output to history</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;; Enable/Disable bypass branch target with dummy read of source buffer</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    goto V_LOOP_LOOP_EXIT                   ; when enabled, step over dummy read and go straight to EXIT</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    V_LOOP_LOOP_BYPASS:                     ; Enable/Disable bypass branch target to perform dummy read of source to clear the source buffer</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    mov [w0 + #ptrSourceRegister], w2       ; load pointer to input source register</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    mov [w2], w1                            ; move value from input source into working register</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    mov [w0 + #ptrDProvControlInputComp], w2 ; load pointer address of target buffer of most recent, compensated controller input from data structure</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    mov w1, [w2]                            ; copy most recent controller input value to given data buffer target</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    V_LOOP_LOOP_EXIT:                       ; Exit control loop branch target</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;; End of routine</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    return                                  ; end of function; return to caller</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;; Global function declaration v_loop_Reset</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;; This function clears control and error histories enforcing a reset</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    .global _v_loop_Reset                   ; provide global scope to routine</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    _v_loop_Reset:                          ; local function label</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;; Clear control history array</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    push w0                                 ; save contents of working register WREG0</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    mov [w0 + #ptrControlHistory], w0       ; set pointer to the base address of control history array</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    clr [w0++]                              ; clear next address of control history array</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    clr [w0++]                              ; clear next address of control history array</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    clr [w0++]                              ; clear next address of control history array</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    clr [w0]                                ; clear last address of control history array</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    pop w0                                  ; restore contents of working register WREG0</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;; Clear error history array</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    push w0                                 ; save contents of working register WREG0</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    mov [w0 + #ptrErrorHistory], w0         ; set pointer to the base address of error history array</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    clr [w0++]                              ; Clear next address of error history array</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    clr [w0++]                              ; Clear next address of error history array</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    clr [w0++]                              ; Clear next address of error history array</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    clr [w0++]                              ; Clear next address of error history array</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    clr [w0]                                ; clear last address of error history array</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    pop w0                                  ; restore contents of working register WREG0</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;; End of routine</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    return                                  ; end of function; return to caller</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;; Global function declaration v_loop_Precharge</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;; This function loads user-defined default values into control and error histories</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    .global _v_loop_Precharge               ; provide global scope to routine</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    _v_loop_Precharge:                      ; local function label</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;; Charge error history array with defined value</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    push w0                                 ; save contents of working register WREG0</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    push w1                                 ; save contents of working register WREG1</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    mov  [w0 + #ptrErrorHistory], w0        ; set pointer to the base address of error history array</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    mov w1, [w0++]                          ; Load user value into next address of error history array</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    mov w1, [w0++]                          ; Load user value into next address of error history array</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    mov w1, [w0++]                          ; Load user value into next address of error history array</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    mov w1, [w0++]                          ; Load user value into next address of error history array</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    mov w1, [w0]                            ; load user value into last address of error history array</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    pop w1                                  ; restore contents of working register WREG1</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    pop w0                                  ; restore contents of working register WREG0</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;; Charge control history array with defined value</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    push w0                                 ; save contents of working register WREG0</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    push w2                                 ; save contents of working register WREG2</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    mov  [w0 + #ptrControlHistory], w0      ; set pointer to the base address of control history array</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    mov w2, [w0++]                          ; Load user value into next address of control history array</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    mov w2, [w0++]                          ; Load user value into next address of control history array</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    mov w2, [w0++]                          ; Load user value into next address of control history array</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    mov w2, [w0]                            ; Load user value into last address of control history array</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    pop w2                                  ; restore contents of working register WREG2</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    pop w0                                  ; restore contents of working register WREG0</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;; End of routine</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    return                                  ; end of function; return to caller</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;; Global function declaration v_loop_PTermUpdate</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;; This function executes a P-Term based control loop used for plant measurements only.</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;; THIS LOOP IS NOT SUITED FOR STABLE OPERATION</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    .global _v_loop_PTermUpdate             ; provide global scope to routine</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    _v_loop_PTermUpdate:                    ; local function label</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;; Check status word for Enable/Disable flag and bypass computation when disabled</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    btss [w0], #NPNZ16_STATUS_ENABLED       ; check ENABLED bit state, skip (do not execute) next instruction if set</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    bra V_LOOP_PTERM_LOOP_BYPASS            ; if ENABLED bit is cleared, jump to end of control code</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;; Read data from input source</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    mov [w0 + #ptrSourceRegister], w2       ; load pointer to input source register</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    mov [w2], w1                            ; move value from input source into working register</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    mov [w0 + #ptrDProvControlInputComp], w2 ; load pointer address of target buffer of most recent, compensated controller input from data structure</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    mov w1, [w2]                            ; copy most recent controller input value to given data buffer target</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;; Load reference and calculate error input to transfer function</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    mov [w0 + #ptrControlReference], w2     ; move pointer to control reference into working register</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    subr w1, [w2], w1                       ; calculate error (=reference - input)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    mov [w0 + #normPreShift], w2            ; move error input scaler into working register</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    sl w1, w2, w1                           ; normalize error result to fractional number format</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;; Load P-gain factor from data structure</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    mov [w0 + #PTermFactor], w6             ; move P-coefficient fractional into working register</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    mov [w0 + #PTermScaler], w2             ; move P-coefficient scaler into working register</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    mov w1, w4                              ; move error to MPY working register</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    ; calculate P-control result</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    mpy w4*w6, a                            ; multiply most recent error with P-coefficient</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    sftac a, w2                             ; shift accumulator to post-scale floating number</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    sac.r a, w4                             ; store accumulator result to working register</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;; Controller Anti-Windup (control output value clamping)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;     </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;; Check for lower limit violation</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    mov [w0 + #MinOutput], w6               ; load lower limit value</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    cpsgt w4, w6                            ; compare values and skip next instruction if control output is within operating range (control output &gt; lower limit)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    mov w6, w4                              ; override controller output</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    V_LOOP_PTERM_CLAMP_MIN_EXIT:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;     </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;; Check for upper limit violation</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    mov [w0 + #MaxOutput], w6               ; load upper limit value</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    cpslt w4, w6                            ; compare values and skip next instruction if control output is within operating range (control output &lt; upper limit)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    mov w6, w4                              ; override controller output</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    V_LOOP_PTERM_CLAMP_MAX_EXIT:</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;; Write control output value to target</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    mov [w0 + #ptrTargetRegister], w8       ; capture pointer to target in working register</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    mov w4, [w8]                            ; move control output to target address</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    mov [w0 + #ptrAltTargetRegister], w8    ; capture pointer to alternate target in working register</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    mov w4, [w8]                            ; move control output to alternate target address</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;; Update ADC trigger locations</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    asr w4, #1, w6                          ; half control output by shifting value one bit to the right</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    ; Update ADC trigger A position</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    mov [w0 + #ADCTriggerAOffset], w8       ; load user-defined ADC trigger A offset value into working register</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    add w6, w8, w10                         ; add user-defined ADC trigger A offset to half of control output</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    mov [w0 + #ptrADCTriggerARegister], w8  ; load pointer to ADC trigger A register into working register</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    mov w10, [w8]                           ; push new ADC trigger value to ADC trigger A register</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;; Enable/Disable bypass branch target with dummy read of source buffer</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    goto V_LOOP_PTERM_LOOP_EXIT             ; when enabled, step over dummy read and go straight to EXIT</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    V_LOOP_PTERM_LOOP_BYPASS:               ; Enable/Disable bypass branch target to perform dummy read of source to clear the source buffer</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    mov [w0 + #ptrSourceRegister], w2       ; load pointer to input source register</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    mov [w2], w1                            ; move value from input source into working register</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    mov [w0 + #ptrDProvControlInputComp], w2 ; load pointer address of target buffer of most recent, compensated controller input from data structure</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    mov w1, [w2]                            ; copy most recent controller input value to given data buffer target</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    V_LOOP_PTERM_LOOP_EXIT:                 ; Exit P-Term control loop branch target</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;; End of routine</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    return                                  ; end of function; return to caller</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;; End of file</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    .end                                    ; end of file v_loop_asm.s</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;;------------------------------------------------------------------------------</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;     </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;; **********************************************************************************</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;;  Download latest version of this tool here: https://areiter128.github.io/DCLD</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;; **********************************************************************************</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_488b9d04ee693d5b67418d8843ae5fee.html">epc9143-avmc.X</a></li><li class="navelem"><a class="el" href="dir_a7f935963e35749abab8dd916753f311.html">sources</a></li><li class="navelem"><a class="el" href="dir_1e409382026c32eca513a266b5866109.html">power_control</a></li><li class="navelem"><a class="el" href="dir_70119375398368c488693f43589b49a8.html">drivers</a></li><li class="navelem"><b>v_loop_asm.s</b></li>
    <p style="height: 12px; padding-bottom: 8px; padding-right: 12px; vertical-align: bottom; text-align: right; font-size: 90%;">Â© 2021, Microchip Technology Inc.</p>
  </ul>
</div>
</body>
</html>
